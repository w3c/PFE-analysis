#include "common/status.h"
#include "hb.h"
#include "patch_subset/file_font_provider.h"
#include "patch_subset/harfbuzz_subsetter.h"

using patch_subset::FileFontProvider;
using patch_subset::FontData;
using patch_subset::HarfbuzzSubsetter;
using patch_subset::StatusCode;

int main(int argc, char** argv) {
  FileFontProvider font_provider(
      "/usr/local/google/home/grieger/src/font_lib/");
  HarfbuzzSubsetter subsetter;

  FontData font;
  if (font_provider.GetFont("ofl/firasans/FiraSans-Light.ttf", &font) !=
      StatusCode::kOk) {
    printf("Font lookup failed\n");
    return -1;
  }

  hb_set_t* codepoints = hb_set_create();
  hb_set_add(codepoints, 13);
  hb_set_add(codepoints, 32);
  hb_set_add(codepoints, 33);
  hb_set_add(codepoints, 34);
  hb_set_add(codepoints, 35);
  hb_set_add(codepoints, 36);
  hb_set_add(codepoints, 37);
  hb_set_add(codepoints, 38);
  hb_set_add(codepoints, 39);
  hb_set_add(codepoints, 40);
  hb_set_add(codepoints, 41);
  hb_set_add(codepoints, 42);
  hb_set_add(codepoints, 43);
  hb_set_add(codepoints, 44);
  hb_set_add(codepoints, 45);
  hb_set_add(codepoints, 46);
  hb_set_add(codepoints, 47);
  hb_set_add(codepoints, 48);
  hb_set_add(codepoints, 49);
  hb_set_add(codepoints, 50);
  hb_set_add(codepoints, 51);
  hb_set_add(codepoints, 52);
  hb_set_add(codepoints, 53);
  hb_set_add(codepoints, 54);
  hb_set_add(codepoints, 55);
  hb_set_add(codepoints, 56);
  hb_set_add(codepoints, 57);
  hb_set_add(codepoints, 58);
  hb_set_add(codepoints, 59);
  hb_set_add(codepoints, 60);
  hb_set_add(codepoints, 61);
  hb_set_add(codepoints, 62);
  hb_set_add(codepoints, 63);
  hb_set_add(codepoints, 64);
  hb_set_add(codepoints, 65);
  hb_set_add(codepoints, 66);
  hb_set_add(codepoints, 67);
  hb_set_add(codepoints, 68);
  hb_set_add(codepoints, 69);
  hb_set_add(codepoints, 70);
  hb_set_add(codepoints, 71);
  hb_set_add(codepoints, 72);
  hb_set_add(codepoints, 73);
  hb_set_add(codepoints, 74);
  hb_set_add(codepoints, 75);
  hb_set_add(codepoints, 76);
  hb_set_add(codepoints, 77);
  hb_set_add(codepoints, 78);
  hb_set_add(codepoints, 79);
  hb_set_add(codepoints, 80);
  hb_set_add(codepoints, 81);
  hb_set_add(codepoints, 82);
  hb_set_add(codepoints, 83);
  hb_set_add(codepoints, 84);
  hb_set_add(codepoints, 85);
  hb_set_add(codepoints, 86);
  hb_set_add(codepoints, 87);
  hb_set_add(codepoints, 88);
  hb_set_add(codepoints, 89);
  hb_set_add(codepoints, 90);
  hb_set_add(codepoints, 91);
  hb_set_add(codepoints, 92);
  hb_set_add(codepoints, 93);
  hb_set_add(codepoints, 94);
  hb_set_add(codepoints, 95);
  hb_set_add(codepoints, 96);
  hb_set_add(codepoints, 97);
  hb_set_add(codepoints, 98);
  hb_set_add(codepoints, 99);
  hb_set_add(codepoints, 100);
  hb_set_add(codepoints, 101);
  hb_set_add(codepoints, 102);
  hb_set_add(codepoints, 103);
  hb_set_add(codepoints, 104);
  hb_set_add(codepoints, 105);
  hb_set_add(codepoints, 106);
  hb_set_add(codepoints, 107);
  hb_set_add(codepoints, 108);
  hb_set_add(codepoints, 109);
  hb_set_add(codepoints, 110);
  hb_set_add(codepoints, 111);
  hb_set_add(codepoints, 112);
  hb_set_add(codepoints, 113);
  hb_set_add(codepoints, 114);
  hb_set_add(codepoints, 115);
  hb_set_add(codepoints, 116);
  hb_set_add(codepoints, 117);
  hb_set_add(codepoints, 118);
  hb_set_add(codepoints, 119);
  hb_set_add(codepoints, 120);
  hb_set_add(codepoints, 121);
  hb_set_add(codepoints, 122);
  hb_set_add(codepoints, 123);
  hb_set_add(codepoints, 124);
  hb_set_add(codepoints, 125);
  hb_set_add(codepoints, 126);
  hb_set_add(codepoints, 160);
  hb_set_add(codepoints, 161);
  hb_set_add(codepoints, 162);
  hb_set_add(codepoints, 163);
  hb_set_add(codepoints, 164);
  hb_set_add(codepoints, 165);
  hb_set_add(codepoints, 166);
  hb_set_add(codepoints, 167);
  hb_set_add(codepoints, 168);
  hb_set_add(codepoints, 169);
  hb_set_add(codepoints, 170);
  hb_set_add(codepoints, 171);
  hb_set_add(codepoints, 172);
  hb_set_add(codepoints, 174);
  hb_set_add(codepoints, 175);
  hb_set_add(codepoints, 176);
  hb_set_add(codepoints, 177);
  hb_set_add(codepoints, 178);
  hb_set_add(codepoints, 179);
  hb_set_add(codepoints, 180);
  hb_set_add(codepoints, 181);
  hb_set_add(codepoints, 182);
  hb_set_add(codepoints, 183);
  hb_set_add(codepoints, 185);
  hb_set_add(codepoints, 186);
  hb_set_add(codepoints, 187);
  hb_set_add(codepoints, 188);
  hb_set_add(codepoints, 189);
  hb_set_add(codepoints, 190);
  hb_set_add(codepoints, 191);
  hb_set_add(codepoints, 192);
  hb_set_add(codepoints, 193);
  hb_set_add(codepoints, 194);
  hb_set_add(codepoints, 195);
  hb_set_add(codepoints, 196);
  hb_set_add(codepoints, 197);
  hb_set_add(codepoints, 198);
  hb_set_add(codepoints, 199);
  hb_set_add(codepoints, 200);
  hb_set_add(codepoints, 201);
  hb_set_add(codepoints, 202);
  hb_set_add(codepoints, 203);
  hb_set_add(codepoints, 204);
  hb_set_add(codepoints, 205);
  hb_set_add(codepoints, 206);
  hb_set_add(codepoints, 207);
  hb_set_add(codepoints, 208);
  hb_set_add(codepoints, 209);
  hb_set_add(codepoints, 210);
  hb_set_add(codepoints, 211);
  hb_set_add(codepoints, 212);
  hb_set_add(codepoints, 213);
  hb_set_add(codepoints, 214);
  hb_set_add(codepoints, 215);
  hb_set_add(codepoints, 216);
  hb_set_add(codepoints, 217);
  hb_set_add(codepoints, 218);
  hb_set_add(codepoints, 220);
  hb_set_add(codepoints, 221);
  hb_set_add(codepoints, 223);
  hb_set_add(codepoints, 224);
  hb_set_add(codepoints, 225);
  hb_set_add(codepoints, 226);
  hb_set_add(codepoints, 227);
  hb_set_add(codepoints, 228);
  hb_set_add(codepoints, 229);
  hb_set_add(codepoints, 230);
  hb_set_add(codepoints, 231);
  hb_set_add(codepoints, 232);
  hb_set_add(codepoints, 233);
  hb_set_add(codepoints, 234);
  hb_set_add(codepoints, 235);
  hb_set_add(codepoints, 236);
  hb_set_add(codepoints, 237);
  hb_set_add(codepoints, 238);
  hb_set_add(codepoints, 239);
  hb_set_add(codepoints, 240);
  hb_set_add(codepoints, 241);
  hb_set_add(codepoints, 242);
  hb_set_add(codepoints, 243);
  hb_set_add(codepoints, 244);
  hb_set_add(codepoints, 245);
  hb_set_add(codepoints, 246);
  hb_set_add(codepoints, 247);
  hb_set_add(codepoints, 248);
  hb_set_add(codepoints, 249);
  hb_set_add(codepoints, 250);
  hb_set_add(codepoints, 251);
  hb_set_add(codepoints, 252);
  hb_set_add(codepoints, 253);
  hb_set_add(codepoints, 257);
  hb_set_add(codepoints, 258);
  hb_set_add(codepoints, 259);
  hb_set_add(codepoints, 260);
  hb_set_add(codepoints, 261);
  hb_set_add(codepoints, 262);
  hb_set_add(codepoints, 263);
  hb_set_add(codepoints, 268);
  hb_set_add(codepoints, 269);
  hb_set_add(codepoints, 270);
  hb_set_add(codepoints, 271);
  hb_set_add(codepoints, 272);
  hb_set_add(codepoints, 273);
  hb_set_add(codepoints, 275);
  hb_set_add(codepoints, 279);
  hb_set_add(codepoints, 280);
  hb_set_add(codepoints, 281);
  hb_set_add(codepoints, 282);
  hb_set_add(codepoints, 283);
  hb_set_add(codepoints, 286);
  hb_set_add(codepoints, 287);
  hb_set_add(codepoints, 297);
  hb_set_add(codepoints, 299);
  hb_set_add(codepoints, 301);
  hb_set_add(codepoints, 302);
  hb_set_add(codepoints, 303);
  hb_set_add(codepoints, 304);
  hb_set_add(codepoints, 305);
  hb_set_add(codepoints, 314);
  hb_set_add(codepoints, 316);
  hb_set_add(codepoints, 317);
  hb_set_add(codepoints, 318);
  hb_set_add(codepoints, 321);
  hb_set_add(codepoints, 322);
  hb_set_add(codepoints, 323);
  hb_set_add(codepoints, 324);
  hb_set_add(codepoints, 326);
  hb_set_add(codepoints, 328);
  hb_set_add(codepoints, 333);
  hb_set_add(codepoints, 336);
  hb_set_add(codepoints, 337);
  hb_set_add(codepoints, 338);
  hb_set_add(codepoints, 339);
  hb_set_add(codepoints, 341);
  hb_set_add(codepoints, 344);
  hb_set_add(codepoints, 345);
  hb_set_add(codepoints, 346);
  hb_set_add(codepoints, 347);
  hb_set_add(codepoints, 350);
  hb_set_add(codepoints, 351);
  hb_set_add(codepoints, 352);
  hb_set_add(codepoints, 353);
  hb_set_add(codepoints, 355);
  hb_set_add(codepoints, 356);
  hb_set_add(codepoints, 357);
  hb_set_add(codepoints, 361);
  hb_set_add(codepoints, 363);
  hb_set_add(codepoints, 366);
  hb_set_add(codepoints, 367);
  hb_set_add(codepoints, 369);
  hb_set_add(codepoints, 371);
  hb_set_add(codepoints, 377);
  hb_set_add(codepoints, 378);
  hb_set_add(codepoints, 379);
  hb_set_add(codepoints, 380);
  hb_set_add(codepoints, 381);
  hb_set_add(codepoints, 382);
  hb_set_add(codepoints, 402);
  hb_set_add(codepoints, 416);
  hb_set_add(codepoints, 417);
  hb_set_add(codepoints, 431);
  hb_set_add(codepoints, 432);
  hb_set_add(codepoints, 536);
  hb_set_add(codepoints, 537);
  hb_set_add(codepoints, 538);
  hb_set_add(codepoints, 539);
  hb_set_add(codepoints, 601);
  hb_set_add(codepoints, 606);
  hb_set_add(codepoints, 614);
  hb_set_add(codepoints, 642);
  hb_set_add(codepoints, 666);
  hb_set_add(codepoints, 699);
  hb_set_add(codepoints, 730);
  hb_set_add(codepoints, 768);
  hb_set_add(codepoints, 769);
  hb_set_add(codepoints, 777);
  hb_set_add(codepoints, 803);
  hb_set_add(codepoints, 902);
  hb_set_add(codepoints, 904);
  hb_set_add(codepoints, 905);
  hb_set_add(codepoints, 908);
  hb_set_add(codepoints, 912);
  hb_set_add(codepoints, 913);
  hb_set_add(codepoints, 914);
  hb_set_add(codepoints, 915);
  hb_set_add(codepoints, 916);
  hb_set_add(codepoints, 917);
  hb_set_add(codepoints, 918);
  hb_set_add(codepoints, 919);
  hb_set_add(codepoints, 920);
  hb_set_add(codepoints, 921);
  hb_set_add(codepoints, 922);
  hb_set_add(codepoints, 923);
  hb_set_add(codepoints, 924);
  hb_set_add(codepoints, 925);
  hb_set_add(codepoints, 926);
  hb_set_add(codepoints, 927);
  hb_set_add(codepoints, 928);
  hb_set_add(codepoints, 929);
  hb_set_add(codepoints, 931);
  hb_set_add(codepoints, 932);
  hb_set_add(codepoints, 933);
  hb_set_add(codepoints, 934);
  hb_set_add(codepoints, 935);
  hb_set_add(codepoints, 936);
  hb_set_add(codepoints, 937);
  hb_set_add(codepoints, 940);
  hb_set_add(codepoints, 941);
  hb_set_add(codepoints, 942);
  hb_set_add(codepoints, 943);
  hb_set_add(codepoints, 945);
  hb_set_add(codepoints, 946);
  hb_set_add(codepoints, 947);
  hb_set_add(codepoints, 948);
  hb_set_add(codepoints, 949);
  hb_set_add(codepoints, 950);
  hb_set_add(codepoints, 951);
  hb_set_add(codepoints, 952);
  hb_set_add(codepoints, 953);
  hb_set_add(codepoints, 954);
  hb_set_add(codepoints, 955);
  hb_set_add(codepoints, 956);
  hb_set_add(codepoints, 957);
  hb_set_add(codepoints, 958);
  hb_set_add(codepoints, 959);
  hb_set_add(codepoints, 960);
  hb_set_add(codepoints, 961);
  hb_set_add(codepoints, 962);
  hb_set_add(codepoints, 963);
  hb_set_add(codepoints, 964);
  hb_set_add(codepoints, 965);
  hb_set_add(codepoints, 966);
  hb_set_add(codepoints, 967);
  hb_set_add(codepoints, 968);
  hb_set_add(codepoints, 969);
  hb_set_add(codepoints, 970);
  hb_set_add(codepoints, 972);
  hb_set_add(codepoints, 973);
  hb_set_add(codepoints, 974);
  hb_set_add(codepoints, 1040);
  hb_set_add(codepoints, 1041);
  hb_set_add(codepoints, 1042);
  hb_set_add(codepoints, 1043);
  hb_set_add(codepoints, 1044);
  hb_set_add(codepoints, 1045);
  hb_set_add(codepoints, 1046);
  hb_set_add(codepoints, 1047);
  hb_set_add(codepoints, 1048);
  hb_set_add(codepoints, 1049);
  hb_set_add(codepoints, 1050);
  hb_set_add(codepoints, 1051);
  hb_set_add(codepoints, 1052);
  hb_set_add(codepoints, 1053);
  hb_set_add(codepoints, 1054);
  hb_set_add(codepoints, 1055);
  hb_set_add(codepoints, 1056);
  hb_set_add(codepoints, 1057);
  hb_set_add(codepoints, 1058);
  hb_set_add(codepoints, 1059);
  hb_set_add(codepoints, 1060);
  hb_set_add(codepoints, 1061);
  hb_set_add(codepoints, 1062);
  hb_set_add(codepoints, 1063);
  hb_set_add(codepoints, 1064);
  hb_set_add(codepoints, 1067);
  hb_set_add(codepoints, 1068);
  hb_set_add(codepoints, 1075);
  hb_set_add(codepoints, 1076);
  hb_set_add(codepoints, 1077);
  hb_set_add(codepoints, 1078);
  hb_set_add(codepoints, 1079);
  hb_set_add(codepoints, 1081);
  hb_set_add(codepoints, 1082);
  hb_set_add(codepoints, 1083);
  hb_set_add(codepoints, 1084);
  hb_set_add(codepoints, 1085);
  hb_set_add(codepoints, 1086);
  hb_set_add(codepoints, 1087);
  hb_set_add(codepoints, 1088);
  hb_set_add(codepoints, 1089);

  FontData subset;
  if (subsetter.Subset(font, *codepoints, &subset) != StatusCode::kOk) {
    printf("Subset call failed\n");
    hb_set_destroy(codepoints);
    return -1;
  }

  hb_set_destroy(codepoints);
  return 0;
}
