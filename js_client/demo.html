<!doctype html>
<html>
  <head>
    <title>Progressive Font Enrichment Demo</title>
    <script src="./patch_subset_wasm.js"></script>
    <script>
      const SENTENCES = [
          ['apache/roboto/Roboto-Thin.ttf', 'Almost before we knew it, we had left the ground.'],
          ['apache/roboto/Roboto-Thin.ttf', 'All their equipment and instruments are alive.'],
          ['apache/roboto/Roboto-Thin.ttf', 'A red flare silhouetted the jagged edge of a wing.'],
          ['apache/roboto/Roboto-Thin.ttf', 'I watched the storm, so beautiful yet terrific.'],
          ['apache/roboto/Roboto-Thin.ttf', 'A shining crescent far beneath the flying vessel.'],
          ['apache/roboto/Roboto-Thin.ttf', 'It was going to be a lonely trip back.'],
          ['apache/roboto/Roboto-Thin.ttf', 'Mist enveloped the ship three hours out from port.'],

          ['apache/roboto/Roboto-Thin.ttf', 'Báº§u trá»i trong xanh thÄƒm tháº³m, khÃ´ng má»™t gá»£n mÃ¢y.'],

          ['apache/roboto/Roboto-Thin.ttf', 'ĞĞ»Ğ°Ñ Ğ²ÑĞ¿Ñ‹ÑˆĞºĞ° Ğ¾ÑĞ²ĞµÑ‚Ğ¸Ğ»Ğ° ÑĞ¸Ğ»ÑƒÑÑ‚ Ğ·Ğ°Ğ·ÑƒĞ±Ñ€ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ ĞºÑ€Ñ‹Ğ»Ğ°.'],
          ['apache/roboto/Roboto-Thin.ttf', 'Ğ’ Ğ²ĞµÑ‡ĞµÑ€Ğ½ĞµĞ¼ ÑĞ²ĞµÑ‚Ğµ Ğ²Ğ¾Ğ»Ğ½Ñ‹ Ğ¾Ñ‚Ñ‡Ğ°ÑĞ½Ğ½Ğ¾ Ğ±Ğ¸Ğ»Ğ¸ÑÑŒ Ğ¾ Ğ±ĞµÑ€ĞµĞ³.'],
          ['apache/roboto/Roboto-Thin.ttf', 'Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°Ñ‚ÑŒÑÑ Ğ½Ğ°Ğ·Ğ°Ğ´ Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ¾ÑĞ»Ğ¾ Ğ² Ğ¾Ğ´Ğ¸Ğ½Ğ¾Ñ‡ĞºÑƒ.'],

          ['ofl/notoserifsc/NotoSerifSC-ExtraLight.otf', 'ä»–ä»¬æ‰€æœ‰çš„è®¾å¤‡å’Œä»ªå™¨å½·ä½›éƒ½æ˜¯æœ‰ç”Ÿå‘½çš„ã€‚'],
          ['ofl/notoserifsc/NotoSerifSC-ExtraLight.otf', 'çº¢è‰²ç«å…‰æ˜ å‡ºé”¯é½¿å½¢æœºç¿¼çš„è½®å»“ã€‚'],
          ['ofl/notoserifsc/NotoSerifSC-ExtraLight.otf', 'æˆ‘çœ‹ç€æš´é£é›¨ï¼Œç¾ä¸èƒœæ”¶å´ä¹ŸæƒŠå¿ƒåŠ¨é­„ã€‚'],
          ['ofl/notoserifsc/NotoSerifSC-ExtraLight.otf', 'ä¸çŸ¥ä¸è§‰é—´ï¼Œæˆ‘ä»¬å·²ç»ç¦»å¼€äº†åœ°é¢ã€‚'],
          ['ofl/notoserifsc/NotoSerifSC-ExtraLight.otf', 'åœ¨é£èˆ¹ä¸‹æ–¹çš„è¿œå¤„ï¼Œæœ‰ä¸€è½®é—ªè€€çš„æ–°æœˆã€‚'],
          ['ofl/notoserifsc/NotoSerifSC-ExtraLight.otf', 'å›ç¨‹ä¼šæ˜¯ä¸€è¶Ÿå­¤ç‹¬çš„æ—…é€”ã€‚'],
          ['ofl/notoserifsc/NotoSerifSC-ExtraLight.otf', 'èˆ¹åªç¦»å¼€æ¸¯å£åï¼Œå°±åœ¨è–„é›¾çš„ç¬¼ç½©ä¸‹èˆªè¡Œäº†'
           + 'ä¸‰å°æ—¶ã€‚'],
          ['ofl/notoserifsc/NotoSerifSC-ExtraLight.otf', 'æˆ‘çš„ä¸¤ç§äººæ ¼æ‹¥æœ‰å…±åŒçš„è®°å¿†ã€‚'],

          ['apache/roboto/Roboto-Thin.ttf', 'Emoji Test'],
      ];

      const PARAGRAPHS = [
          ['apache/roboto/Roboto-Regular.ttf', 'A peep at some distant orb has power to raise and purify our '
           + 'thoughts like a strain of sacred music, or a noble picture, or a passage from the '
           + 'grander poets. It always does one good.'],
          ['apache/roboto/Roboto-Regular.ttf', 'Apparently we had reached a great height in the atmosphere, for '
           + 'the sky was a dead black, and the stars had ceased to twinkle. By the same illusion '
           + 'which lifts the horizon of the sea to the level of the spectator on a hillside, the '
           + 'sable cloud beneath was dished out, and the car seemed to float in the middle of an '
           + 'immense dark sphere, whose upper half was strewn with silver.'],
          ['apache/roboto/Roboto-Regular.ttf', 'As I went on, still gaining velocity, the palpitation of night '
           + 'and day merged into one continuous greyness; the sky took on a wonderful deepness of '
           + 'blue, a splendid luminous color like that of early twilight; the jerking sun became a '
           + 'streak of fire, a brilliant arch, in space; the moon a fainter fluctuating band; and '
           + 'I could see nothing of the stars, save now and then a brighter circle flickering in '
           + 'the blue.'],
          ['apache/roboto/Roboto-Regular.ttf', 'As the minuteness of the parts formed a great hindrance to my '
           + 'speed, I resolved, contrary to my first intention, to make the being of a gigantic '
           + 'stature; that is to say, about eight feet in height, and proportionably large. After '
           + 'having formed this determination, and having spent some months in successfully '
           + 'collecting and arranging my materials, I began.'],
          ['apache/roboto/Roboto-Regular.ttf', 'I shall see the face of Mars, anyhow, and that will be a rare '
           + 'experience. It seems to me that a view of the heavenly bodies through a fine telescope, '
           + 'as well as a tour round the world, should form a part of a liberal education.'],
          ['apache/roboto/Roboto-Regular.ttf', 'Though the gravity still dragged at him, his muscles were making '
           + 'great efforts to adjust. After the daily classes he no longer collapsed immediately '
           + 'into bed. Only the nightmares got worse.'],
          ['apache/roboto/Roboto-Regular.ttf', 'Truly it was a great journey, and in it I met with many, whom to '
           + 'know was to love; but whom never could I see again; for life has not space enough; '
           + 'and each must do his duty to the security and well-being of the Redoubt. Yet, for all '
           + 'that I have set down, we travelled much, always; but there were so many millions, '
           + 'and so few years.'],

          ['apache/roboto/Roboto-Regular.ttf', 'ChÃºng tÃ´i Ä‘Ã£ Ä‘áº¡t tá»›i Ä‘á»™ cao ráº¥t lá»›n trong khÃ­ quyá»ƒn '
           + 'vÃ¬ báº§u trá»i tá»‘i Ä‘en vÃ  cÃ¡c vÃ¬ sao khÃ´ng cÃ²n láº¥p lÃ¡nh. áº¢o giÃ¡c vá» Ä‘Æ°á»ng chÃ¢n trá»i khiáº¿n '
           + 'Ä‘Ã¡m mÃ¢y áº£m Ä‘áº¡m bÃªn dÆ°á»›i lÃµm xuá»‘ng vÃ  chiáº¿c xe nhÆ° trÃ´i bá»“ng bá»nh giá»¯a quáº£ cáº§u khá»•ng lá»“ '
           + 'tÄƒm tá»‘i.'],

          ['apache/roboto/Roboto-Regular.ttf', 'Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ Ğ³Ñ€Ğ°Ğ²Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ²Ñ‹Ğ¼Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ»Ğ° ĞµĞ³Ğ¾, Ğ½Ğ¾ Ğ¼Ñ‹ÑˆÑ†Ñ‹ Ğ¸Ğ·Ğ¾ '
           + 'Ğ²ÑĞµÑ… ÑĞ¸Ğ» Ğ¿Ñ‹Ñ‚Ğ°Ğ»Ğ¸ÑÑŒ Ğ¿Ñ€Ğ¸ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ¸Ñ‚ÑŒÑÑ. ĞĞ±ĞµÑÑĞ¸Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹, Ğ¾Ğ½ ÑƒĞ¶Ğµ Ğ½Ğµ Ğ²Ğ°Ğ»Ğ¸Ğ»ÑÑ Ğ² Ğ¿Ğ¾ÑÑ‚ĞµĞ»ÑŒ ÑÑ€Ğ°Ğ·Ñƒ '
           + 'Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ğ½ÑÑ‚Ğ¸Ğ¹. ĞšĞ¾ÑˆĞ¼Ğ°Ñ€Ñ‹, Ğ½Ğµ Ğ¿Ğ¾ĞºĞ¸Ğ´Ğ°Ğ²ÑˆĞ¸Ğµ ĞµĞ³Ğ¾, ÑÑ‚Ğ°Ğ»Ğ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ…ÑƒĞ¶Ğµ.'],
          ['apache/roboto/Roboto-Regular.ttf', 'Ğ›Ğ¸ÑˆÑŒ Ğ¾Ğ´Ğ¸Ğ½ Ğ²Ğ·Ğ³Ğ»ÑĞ´ Ğ½Ğ° Ğ´Ğ°Ğ»ĞµĞºÑƒÑ Ğ¿Ğ»Ğ°Ğ½ĞµÑ‚Ñƒ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ²Ğ¾Ğ·Ğ²Ñ‹ÑĞ¸Ñ‚ÑŒ '
           + 'Ğ¸ Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑˆĞ¸ Ğ¼Ñ‹ÑĞ»Ğ¸ Ğ½Ğµ Ñ…ÑƒĞ¶Ğµ Ğ´ÑƒÑ…Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¼ÑƒĞ·Ñ‹ĞºĞ¸, Ğ¿Ñ€ĞµĞºÑ€Ğ°ÑĞ½Ğ¾Ğ¹ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½Ñ‹ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… '
           + 'ÑÑ‚Ñ€Ğ¾Ğº. Ğ­Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ½Ğ¾ÑĞ¸Ñ‚ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºÑƒ Ğ½ĞµÑĞ¾Ğ¼Ğ½ĞµĞ½Ğ½ÑƒÑ Ğ¿Ğ¾Ğ»ÑŒĞ·Ñƒ.'],
          ['apache/roboto/Roboto-Regular.ttf', 'ĞœĞµĞ»ĞºĞ¸Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ·Ğ°Ğ¼ĞµĞ´Ğ»Ğ¸Ğ»Ğ¸ Ğ±Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ, '
           + 'Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ, Ğ²Ğ¾Ğ¿Ñ€ĞµĞºĞ¸ Ğ¼Ğ¾ĞµĞ¼Ñƒ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ Ğ½Ğ°Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ, Ñ Ñ€ĞµÑˆĞ¸Ğ» ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾ Ğ¾Ğ³Ñ€Ğ¾Ğ¼Ğ½Ğ¾Ğ³Ğ¾ '
           + 'Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ°: Ğ¼Ğ¾Ñ‰Ğ½Ğ¾Ğµ, Ğ¾ĞºĞ¾Ğ»Ğ¾ Ğ´Ğ²ÑƒÑ… Ñ Ğ¿Ğ¾Ğ»Ğ¾Ğ²Ğ¸Ğ½Ğ¾Ğ¹ Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ² Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¼. ĞŸĞ¾Ñ‚Ñ€Ğ°Ñ‚Ğ¸Ğ² Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¼ĞµÑÑÑ†ĞµĞ² Ğ½Ğ° '
           + 'ÑĞ±Ğ¾Ñ€ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ¾Ğ², Ñ Ğ¿Ñ€Ğ¸ÑÑ‚ÑƒĞ¿Ğ¸Ğ» Ğº Ğ´ĞµĞ»Ñƒ.'],

          ['ofl/notosanssc/NotoSansSC-Regular.otf', 'è¿œæ–¹çš„æ˜Ÿä½“çŠ¹å¦‚åœ£ä¹ã€åç”»æˆ–ä¼Ÿå¤§è¯—äººçš„è¯—å¥ï¼Œä¸€çœ¼ç¬'
           + 'é—´å°±èƒ½è®©æˆ‘ä»¬çš„æ€æƒ³å‡åä¸å‡€åŒ–ã€‚å®ƒæ€»æ˜¯èƒ½ç»™äººå¸¦æ¥ç§¯æçš„å½±å“ã€‚'],
          ['ofl/notosanssc/NotoSansSC-Regular.otf', 'æ˜¾ç„¶ï¼Œæˆ‘ä»¬å·²åˆ°è¾¾å¤§æ°”å±‚ä¸­æé«˜çš„ä½ç½®ï¼Œå¤©ç©ºæ˜¯ä¸€ç‰‡'
           + 'æ­»å¯‚çš„é»‘ï¼Œæ˜Ÿæ˜Ÿä¹Ÿä¸å†é—ªçƒã€‚å°±åƒä»å±±é¡¶è¿œçœºæ—¶ï¼Œä¼šäº§ç”Ÿæµ·å¹³çº¿ä¸è§†é‡ç­‰é«˜çš„é”™è§‰ï¼Œä¸‹æ–¹ä¹Œäº‘æ•£å¼€'
           + 'äº†ï¼Œè€Œè½¦å­å½·ä½›æ¼‚æµ®åœ¨æµ“é»‘æ°”å›¢çš„ä¸­å¤®ï¼Œæ°”å›¢ä¸ŠåŠéƒ¨è¿˜é•¶ç€é“¶è¾¹ã€‚'],
          ['ofl/notosanssc/NotoSansSC-Regular.otf', 'æˆ‘ç»§ç»­èˆªè¡Œï¼Œé€Ÿåº¦è¿˜åœ¨åŠ å¿«ï¼Œæ—¥ä¸å¤œäº¤æ›¿æ™ƒåŠ¨ï¼Œèåˆ'
           + 'æˆè¿è´¯çš„ç°ï¼›å¤©ç©ºæ˜¯ä¸€ç‰‡ç¾å¥½æ·±è“ï¼ŒçŠ¹å¦‚é»„æ˜çš„ç¿çƒ‚æ˜äº®ï¼›è·³è·ƒçš„å¤ªé˜³æˆäº†ä¸€é“ç«ç„°ï¼Œåœ¨å¤ªç©ºä¸­'
           + 'ç”»å‡ºä¸€é“è€€çœ¼åœ†å¼§ï¼›æœˆäº®åˆ™æ˜¯ä¸€é•¿æ¡èµ·ä¼ä¸æ–­çš„å¼±å…‰ï¼›æˆ‘çœ‹ä¸è§ä»»ä½•æ˜Ÿæ˜Ÿï¼Œåªæ˜¯å¶å°”èƒ½çœ‹åˆ°ä¸€ä¸ª'
           + 'æ˜äº®çš„å…‰åœˆåœ¨è¿™ç‰‡æ·±è“ä¸­é—ªçƒ'],
          ['ofl/notosanssc/NotoSansSC-Regular.otf', 'ç”±äºå„ä¸ªé›¶ä»¶éƒ½è¿‡äºå¾®å°ï¼Œæˆ‘çš„åˆ¶é€ é€Ÿåº¦å—åˆ°äº†æå¤§'
           + 'çš„é˜»ç¢ï¼Œå› æ­¤æˆ‘å†³å®šè¿èƒŒè‡ªå·±çš„åˆè¡·ï¼Œæ”¹ä¸ºåˆ¶é€ ä¸€ä¸ªåºç„¶å¤§ç‰©ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé«˜çº¦8è‹±å°ºï¼Œå„éƒ¨åˆ†ä¹Ÿ'
           + 'éƒ½æŒ‰æ¯”ä¾‹æ”¾å¤§ã€‚ä¸‹å®šå†³å¿ƒåï¼Œæˆ‘èŠ±è´¹å‡ ä¸ªæœˆçš„æ—¶é—´æˆåŠŸæ”¶é›†å’Œæ•´ç†äº†æ‰€éœ€çš„ææ–™ï¼Œç„¶åå°±å¼€å§‹å®'
           + 'æ–½æˆ‘çš„è®¡åˆ’äº†ã€‚'],
          ['ofl/notosanssc/NotoSansSC-Regular.otf', 'æ— è®ºå¦‚ä½•ï¼Œæˆ‘å°†ä¼šçœ‹åˆ°ç«æ˜Ÿçš„é¢è²Œï¼Œè€Œè¿™å°†ä¼šæ˜¯ä¸€æ¬¡'
           + 'æå…¶éš¾å¾—çš„ç»å†ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œé€šè¿‡é«˜çº§æœ›è¿œé•œè§‚çœ‹å¤©ä½“ä»¥åŠç¯æ¸¸ä¸–ç•Œï¼Œéƒ½åº”è¯¥æ˜¯äººæ–‡æ•™è‚²ä¸å¯æˆ–'
           + 'ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚'],
          ['ofl/notosanssc/NotoSansSC-Regular.otf', 'å°½ç®¡åœ°å¿ƒå¼•åŠ›ä»ä½¿ä»–éš¾ä»¥å‰è¡Œï¼Œä½†ä»–çš„è‚Œè‚‰åœ¨åŠªåŠ›'
           + 'åœ°é€‚åº”ã€‚ä¸Šå®Œæ¯å¤©çš„è¯¾ç¨‹åï¼Œä»–ä¸å†ç«‹åˆ»ç˜«å€’åœ¨åºŠä¸Šã€‚åªæ˜¯æ¢¦é­‡è¶Šæ¥è¶Šå¯æ€•ã€‚'],
          ['ofl/notosanssc/NotoSansSC-Regular.otf', 'è¿™ç¡®å®æ˜¯ä¸€æ¬¡ååˆ†ä¸é”™çš„æ—…ç¨‹ã€‚åœ¨æ—…é€”ä¸­ï¼Œæˆ‘é‡åˆ°äº†'
           + 'å¾ˆå¤šè®©æˆ‘æ„Ÿè§‰ç›¸è§æ¨æ™šä½†åˆå†ä¹Ÿä¸ä¼šé‡é€¢çš„äººï¼›å› ä¸ºäººç”Ÿæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œæ¯ä¸ªäººéƒ½å¿…é¡»å°½è‡ªå·±'
           + 'çš„è´£ä»»å»å®ˆæŠ¤ä¸€æ–¹å¤©åœ°çš„å®‰å…¨å’Œç¦ç¥‰ã€‚ç„¶è€Œï¼Œå°½ç®¡èµ°è¿‡åƒå±±ä¸‡æ°´ï¼Œæˆ‘ä»¬ä¾ç„¶åšæŒæ—…è¡Œï¼Œæœªæ›¾åœæ­‡'
           + 'ï¼Œåªæ˜¯ä¸–ç•Œé£æ™¯å¤šå¦‚ç¹æ˜Ÿï¼Œäººç”Ÿå´ä»…çŸ­çŸ­æ•°åå¹´ã€‚'],
          ['ofl/notosanssc/NotoSansSC-Regular.otf', 'æœ‰ä¸€ä¸ªä¸æ˜ç‰©ä½“ï¼Œçœ‹èµ·æ¥åƒæ˜¯ä¸€å°ç‰‡ç´«è‰²çš„è‰ï¼Œä¸”'
           + 'é¢ç§¯åœ¨ 5 å¹³æ–¹è‹±å°ºä»¥ä¸Šï¼Œæ­£ç©¿è¿‡æ²™åœ°æœç€ä»–ä»¬ç§»åŠ¨ã€‚å½“å®ƒé å¾—è¶³å¤Ÿè¿‘æ—¶ï¼Œä»–æ‰å‘ç°è¿™ä¸æ˜¯è‰ï¼Œ'
           + 'æ²¡æœ‰å¶å­ï¼Œåªæœ‰ç´«è‰²çš„æ ¹ã€‚è¿™ä¸€æ•´ç‰‡ä¸­çš„æ¯æ ªå°æ¤ç‰©çš„ç´«è‰²æ ¹éƒ½åœ¨æ—‹è½¬ï¼Œå°±åƒæ— è¾¹ç¼˜è½®è½´çš„è¾æ¡'
           + 'ä¸€æ ·ã€‚'],

          ['apache/notocoloremojicompat/NotoColorEmojiCompat-Regular.ttf',
           'ğŸ¤›ğŸ»ğŸ¤›ğŸ¼ğŸ¤›ğŸ½ğŸ¤›ğŸ¿ğŸ§”ğŸ¿ğŸ‘¨ğŸ»â€ğŸ¦°ğŸ‘¨ğŸ¼â€ğŸ¦°ğŸ‘¨ğŸ½â€ğŸ¦°ğŸ‘¨ğŸ¾â€ğŸ¦°ğŸ§‘ğŸ»â€ğŸ¦°ğŸ§‘ğŸ¼â€ğŸ¦°ğŸ§‘ğŸ½â€ğŸ¦°ğŸ§‘ğŸ¾â€ğŸ¦°ğŸ§‘ğŸ¿â€ğŸ¦°ğŸ‘©ğŸ»â€ğŸ¦±ğŸ‘©ğŸ¼â€ğŸ¦±ğŸ‘©ğŸ½â€ğŸ¦±ğŸ‘©ğŸ¾â€ğŸ¦±ğŸ¥¬ğŸ¥¦ğŸ§„ğŸ§…ğŸ¥œğŸğŸ¥ğŸš”ğŸš–ğŸš™ğŸ›»ğŸš›'],
      ];

      var page_index = -1;
      var states = {};
      var also_load_unicode_range = true;
      var show_unicode_range = false;
      var use_prediction = false;

      async function update_all_fonts() {
          if (page_index < 0) {
              update_transfer_bars();
              return;
          }

          title_font = SENTENCES[page_index][0];
          title_text = SENTENCES[page_index][1]
          paragraph_font = PARAGRAPHS[page_index][0];
          paragraph_text = PARAGRAPHS[page_index][1];

          p1 = update_fonts(title_text,
                            title_font,
                            "Title Font");
          p2 = update_fonts(paragraph_text,
                            paragraph_font,
                            "Paragraph Font");
          await p1;
          await p2;

          document.getElementById("title_pfe").textContent = title_text;
          document.getElementById("paragraph_pfe").textContent = paragraph_text;
          if (also_load_unicode_range) {
              document.getElementById("title_ur").textContent = title_text;
              document.getElementById("paragraph_ur").textContent = paragraph_text;
          }

          document.getElementById("prev").disabled = (page_index == 0);
          document.getElementById("next").disabled = (page_index == PARAGRAPHS.length - 1);

          update_transfer_bars();
          update_sample_toggle();
      }

      function update_sample_toggle() {
          document.getElementById("sample_toggle").style.visibility =
              (page_index >= 0 && also_load_unicode_range) ? "visible" : "hidden";
          document.getElementById("sample_toggle").value =
              show_unicode_range ? "Show progressive font enrichment" : "Show unicode range";

          if (show_unicode_range) {
              document.getElementById("pfe_sample").classList.add("hide");
              document.getElementById("ur_sample").classList.remove("hide");
          } else {
              document.getElementById("pfe_sample").classList.remove("hide");
              document.getElementById("ur_sample").classList.add("hide");
          }
      }

      function update_fonts(text, font_id, font_face) {
          cps = new Set()
          for (var i = 0; text.codePointAt(i); i++) {
              cps.add(text.codePointAt(i));
          }

          cps_array = []
          for (let cp of cps) {
              cps_array.push(cp);
          }

          return patch_codepoints(font_id, font_face, cps_array);
      }

      function patch_codepoints(font_id, font_face, cps) {
          if (use_prediction) {
              font_id = "with_prediction/" + font_id;
          }
          if (!states[font_id]) {
              states[font_id] = new window.Module.State(font_id);
          }
          var state = states[font_id];
          return new Promise(resolve => {
              state.extend(cps, async function(result) {
                  if (!result) {
                      resolve(result);
                      return;
                  }
                  font = state.font_data();
                  font = new FontFace(font_face, font);
                  if (font_face == "Title Font") {
                      font.weight = 100;
                  }
                  document.fonts.add(font);
                  await font.load();
                  resolve(result);
              });
          });
      }

      function update_transfer_bars() {
          var pfe_total = 0;
          var ur_total = 0;
          for (let r of performance.getEntriesByType("resource")) {
              if (r.name.includes("/experimental/patch_subset")
                  && (r.name.endsWith(".ttf") || r.name.endsWith(".otf"))) {
                  pfe_total += r.transferSize;
              }
              if (r.name.includes("/s/")) {
                  ur_total += r.transferSize;
              }
          }
          var total = Math.max(Math.max(pfe_total, ur_total), 1);
          document.getElementById("pfe_bar").style.width =
              ((pfe_total / total) * 100) + "%";
          document.getElementById("pfe_bar").textContent = as_string(pfe_total);

          document.getElementById("ur_bar").style.width =
              ((ur_total / total) * 100) + "%";
          document.getElementById("ur_bar").textContent = as_string(ur_total);

          document.getElementById("ur_byte_counter").style.visibility =
              (also_load_unicode_range ? "visible" : "hidden");
      }

      function as_string(byte_count) {
          return Math.round(byte_count / 1000).toLocaleString() + " kb";
      }

      createModule().then(function(Module) {
          window.Module = Module;
          update_transfer_bars();
      });

      window.addEventListener('DOMContentLoaded', function() {
          prev = document.getElementById("prev");
          prev.addEventListener("click", function() {
              page_index--;
              if (page_index < 0) page_index = 0;
              update_all_fonts();
          });
          next = document.getElementById("next");
          next.addEventListener("click", function() {
              page_index++;
              if (page_index >= PARAGRAPHS.length) page_index = PARAGRAPHS.length - 1;
              update_all_fonts();
          });
          document.getElementById("also_ur").addEventListener("change", function(e) {
              also_load_unicode_range = e.target.checked;
              if (!also_load_unicode_range) {
                  sample_toggle = false;
              }
              update_all_fonts();
              update_sample_toggle();
          });
          document.getElementById("prediction").addEventListener("change", function(e) {
              use_prediction = e.target.checked;
          });
          document.getElementById("sample_toggle").addEventListener("click", e => {
              show_unicode_range = !show_unicode_range;
              update_sample_toggle();
          });
      });
      document.fonts.addEventListener('loadingdone', function() {
          update_transfer_bars();
      });
    </script>
    <style>
      h1 {
          font-size: 3em;
      }

      div.pfe, div.ur {
          font-size: 1.5em;
      }

      h1.pfe {
          font-family: "Title Font", serif;
          font-weight: 100;
      }

      div.pfe {
          font-family: "Paragraph Font", serif;
      }

      h1.ur {
          font-family: "Roboto", "Noto Serif SC";
          font-weight: 100;
      }

      div.ur {
          font-family: "Roboto", "Noto Sans SC", "Noto Color Emoji Compat";
      }

      input, label {
          font-family: sans-serif;
          font-size: 1.5em;
      }

      .sample_text, .metrics, .controls {
          padding: 1em;
          margin: 0.3em;
      }

      .sample_text, .metrics {
          border: 1px solid #AAAAAA;
          border-radius: 0.3em;
          height: 100%;
      }

      .text_and_metrics {
          height: 50em;
      }

      .sample_text {
          display: inline-block;
          width: 45em;
      }

      .metrics {
          display: inline-block;
          width: 25em;
          vertical-align: top;
      }

      .metrics_inner {
          font-family: sans-serif;
          font-size: 1.5em;
      }

      .metrics_inner span, .metrics_inner div {
          margin: 0.3em 0;
      }

      .bar {
          white-space: nowrap;
          background-color: #1999d4;
          padding: 0.25em 0 0.25em 0.2em;
          border-radius: 2px;
      }

      .hide {
          position: absolute;
          top: 0;
          left: -10000px;
      }

      #ur_byte_counter {
          visibility: hidden;
      }

      .type {
          font-size: 0.8em;
          font-color: #BBBBBB;
          font-family: sans-serif;
      }
    </style>
    <link href="fonts.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <div class="controls">
      <input type="button" value="Previous" id="prev" disabled="true" />
      <input type="button" value="Next" id="next"/>
      <input type="button" value="Show Unicode Range" id="sample_toggle" style="visibility: hidden;" />
      <br/>
      <input type="checkbox" id="also_ur" name="also_ur" checked />
      <label for="also_ur">Also load fonts via unicode range.</label><br/>
      <input type="checkbox" id="prediction" name="prediction" />
      <label for="prediction">Use codepoint prediction.</label>
    </div>
    <div class="text_and_metrics">
      <div id="pfe_sample" class="sample_text">
        <div class="type">Progressive Font Enrichment</div>
        <h1 id="title_pfe" class="pfe">Progressive Font Enrichment Demo</h1>
        <div id="paragraph_pfe" class="pfe">
          This demonstrates the use of the patch subset progressive font enrichment protocol
          to incrementaly load fonts for a variety of languages.
          <br/><br/>
          Instructions:
          <ul>
            <li>Next/Previous will switch between text samples. Switching to a new sample will use
            PFE to load any additional font data needed for it.</li>
            <li>If "Also load fonts via unicode range" is selected then fonts will be
              loaded via the Google Fonts API (using unicode range) in parallel to
              the progressive font enrichment.</li>
            <li><b>Disable caching (via dev console) or force refresh the page (ctrl+shift+r) before
              starting. If caching is enabled the unicode range font loading may be served from
              the cache which will make the bytes transferred incorrect.</b></li>
            <li>If unicode range loading is enabled you can switch the displayed text
              sample between the two methods using the "Show unicode range" button.</li>
          </ul>
          Interesting things to try:
          <ul>
            <li>Switching between the unicode range and pfe text for the cyrillic and vietnamese
              samples demonstrates how unicode range breaks kerning between characters in different
              subsets</li>
          </ul>
        </div>
      </div>
      <div id="ur_sample" class="sample_text hide">
        <div class="type">Unicode range</div>
        <h1 id="title_ur" class="ur"></h1>
        <div id="paragraph_ur" class="ur"></div>
      </div>
      <div class="metrics">
        <div class="metrics_inner">
          <span>Progressive enrichment transferred:</span>
          <div id="pfe_bar" class="bar"></div>
          <div id="ur_byte_counter">
            <span>Unicode range transferred:</span>
            <div id="ur_bar" class="bar"></div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
